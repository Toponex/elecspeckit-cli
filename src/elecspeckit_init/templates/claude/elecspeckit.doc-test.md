---
description: 为测试工程师生成测试视图文档
handoffs: []
---

## Command: `/elecspeckit.doc-test`

**Goal**
基于当前硬件特性的 `spec.md` 和 `tasks.md`，为测试工程师生成专属的测试视图文档 `docs/test-view.md`，聚焦验收场景、测试任务和需求覆盖关系。

**Execution Steps (for the AI assistant)**
1. 在目标项目根目录工作，与用户确认当前特性的 `FEATURE_DIR = specs/00X-shortname/`，并在其中定位：
   - `FEATURE_SPEC   = FEATURE_DIR/spec.md`；
   - `FEATURE_TASKS  = FEATURE_DIR/tasks.md`；
   - `FEATURE_DOCS   = FEATURE_DIR/docs/`（如不存在，则创建）。

2. 从 `spec.md` 中提取验收场景：
   - 读取 `spec.md` 中的验收场景章节（如"Acceptance Scenarios"、"验收测试"）；
   - 识别关键验收场景（如"输入电压范围测试"、"输出功率测试"、"EMC测试"等）；
   - 提取每个场景的测试条件、预期结果和判定标准。

3. 从 `tasks.md` 中提取 `[VIEW:TEST]` 标记的任务：
   - 扫描 `tasks.md` 中所有任务描述；
   - 筛选包含 `[VIEW:TEST]` 标记的任务；
   - 这些任务通常涉及测试用例编写、测试执行、测试报告等。

4. 建立需求覆盖关系：
   - 对于每个验收场景，找到对应的测试任务；
   - 建立验收场景到测试任务的映射关系（追溯矩阵）；
   - 识别未覆盖的验收场景或缺失的测试任务，标记为"待补充"。

5. 按测试类型分类：
   - **功能测试**：验证功能需求（如电压范围、功率输出、USB PD协议握手）；
   - **性能测试**：验证性能指标（如效率、纹波、温升）；
   - **可靠性测试**：验证可靠性要求（如老化测试、冷热冲击）；
   - **安全测试**：验证安全标准（如隔离耐压、爬电距离、温升限值）；
   - **EMC测试**：验证电磁兼容性（如传导干扰、辐射干扰）。

6. 生成 `FEATURE_DIR/docs/test-view.md`：
   - **验收场景列表**：列出所有验收场景及其判定标准；
   - **测试任务清单**：列出所有 `[VIEW:TEST]` 任务，包括任务ID、描述、状态；
   - **需求覆盖矩阵**：建立验收场景到测试任务的映射关系；
   - **测试类型分类**：按功能/性能/可靠性/安全/EMC分类测试任务；
   - **测试进度跟踪**：统计已完成/进行中/待执行的测试任务数量；
   - **未覆盖需求**：列出缺失的测试任务或未覆盖的验收场景。

7. 向用户总结：
   - 本次生成的 `test-view.md` 包含了哪些验收场景和测试任务；
   - 当前测试覆盖率（如"已覆盖12/15个验收场景，覆盖率80%"）；
   - 提醒关注的未覆盖需求或缺失测试；
   - 建议下一步操作（如"补充EMC测试任务"、"执行性能测试"）。

**Notes**
- `/elecspeckit.doc-test` 专注于测试工程师视角，不涉及硬件设计或BOM任务；
- 测试视图文档应与 `spec.md` 中的验收场景保持一致，确保需求覆盖完整；
- `[VIEW:TEST]` 标记用于在 `tasks.md` 中标识测试相关任务，确保任务拆分时正确标记；
- 需求覆盖矩阵用于追溯验证，确保每个验收场景都有对应的测试任务。

**Example: 测试视图文档结构**

```markdown
# 测试视图: 60W PD充电头

## 验收场景列表

### AS1: 输入电压范围测试
- **测试条件**: 输入电压 85-265VAC, 频率 47-63Hz
- **预期结果**: 所有输入电压下正常工作，无保护触发
- **判定标准**: 输出电压偏差 <5%，输出纹波 <100mVpp
- **对应测试**: T050, T051

### AS2: 输出功率测试
- **测试条件**: 输出5V/9V/12V/15V/20V @ 3A，输入220VAC
- **预期结果**: 所有档位功率输出正常，USB PD协议握手成功
- **判定标准**: 输出功率偏差 <3%，电压偏差 <5%
- **对应测试**: T052, T053, T054

### AS3: 效率测试
- **测试条件**: 220VAC输入，各档位满载/轻载
- **预期结果**: 满载效率 >94%，轻载(10%)效率 >85%
- **判定标准**: 符合DoE Level VI要求
- **对应测试**: T055

### AS4: 隔离耐压测试
- **测试条件**: 初级-次级 4000VAC @ 60s
- **预期结果**: 无击穿、无飞弧
- **判定标准**: IEC 62368-1
- **对应测试**: T060

### AS5: EMC传导干扰测试
- **测试条件**: CISPR 32 Class B限值
- **预期结果**: 传导干扰符合Class B
- **判定标准**: 150kHz-30MHz频段，准峰值/平均值均符合限值
- **对应测试**: T065

## 测试任务清单

### 功能测试

- [ ] T050 [VIEW:TEST] 输入电压范围测试 (85-265VAC)
- [ ] T051 [VIEW:TEST] 输入频率范围测试 (47-63Hz)
- [x] T052 [VIEW:TEST] USB PD协议握手测试 (5V-20V档位)
- [ ] T053 [VIEW:TEST] 输出功率测试 (各档位 @ 3A)
- [ ] T054 [VIEW:TEST] 动态响应测试 (0-100% load step)

### 性能测试

- [ ] T055 [VIEW:TEST] 效率测试 (满载/轻载，各档位)
- [ ] T056 [VIEW:TEST] 输出纹波测试 (<100mVpp @ 20MHz)
- [ ] T057 [VIEW:TEST] 温升测试 (环境25°C，满载运行)

### 可靠性测试

- [ ] T058 [VIEW:TEST] 老化测试 (100小时，满载，环境50°C)
- [ ] T059 [VIEW:TEST] 冷热冲击测试 (-10°C~+50°C，循环100次)

### 安全测试

- [ ] T060 [VIEW:TEST] 隔离耐压测试 (4000VAC @ 60s)
- [ ] T061 [VIEW:TEST] 爬电距离检查 (加强绝缘 ≥6.4mm)
- [ ] T062 [VIEW:TEST] 温升限值测试 (元器件表面温度限值检查)

### EMC测试

- [ ] T063 [VIEW:TEST] 传导干扰测试 (CISPR 32 Class B)
- [ ] T064 [VIEW:TEST] 辐射干扰测试 (CISPR 32 Class B)
- [ ] T065 [VIEW:TEST] 静电放电抗扰度测试 (IEC 61000-4-2, Level 3)
- [ ] T066 [VIEW:TEST] 快速瞬变脉冲群测试 (IEC 61000-4-4, Level 3)

## 需求覆盖矩阵

| 验收场景 | 对应测试任务 | 状态 | 覆盖情况 |
|---------|-------------|------|---------|
| AS1: 输入电压范围 | T050, T051 | 待执行 | ✓ 已覆盖 |
| AS2: 输出功率 | T052, T053, T054 | T052已完成，其他待执行 | ✓ 已覆盖 |
| AS3: 效率 | T055 | 待执行 | ✓ 已覆盖 |
| AS4: 隔离耐压 | T060 | 待执行 | ✓ 已覆盖 |
| AS5: EMC传导干扰 | T063 | 待执行 | ✓ 已覆盖 |
| AS6: 温升 | T057, T062 | 待执行 | ✓ 已覆盖 |
| AS7: 可靠性 | T058, T059 | 待执行 | ✓ 已覆盖 |

## 测试进度跟踪

- **总测试任务**: 17个
- **已完成**: 1个 (T052)
- **进行中**: 0个
- **待执行**: 16个
- **测试覆盖率**: 7/7 验收场景已覆盖 (100%)
- **任务完成率**: 1/17 (6%)

## 未覆盖需求

无 - 所有验收场景均已覆盖对应的测试任务。

## 下一步建议

1. 优先执行功能测试（T050-T054），验证基本功能
2. 完成性能测试（T055-T057），评估效率和温升
3. 安排EMC预测试（T063-T066），尽早识别EMC风险
4. 最后执行可靠性测试（T058-T059），确保长期稳定性
```
