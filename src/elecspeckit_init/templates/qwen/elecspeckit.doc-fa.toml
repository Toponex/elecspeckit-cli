description = "为FA工程师生成可制造性与可测试性视图文档"

prompt = """---
description: 为FA工程师生成可制造性与可测试性视图文档
handoffs: []
---

## Command: `/elecspeckit.doc-fa`

**Goal**
基于当前硬件特性的 `tasks.md`，为FA（Failure Analysis）工程师和DFM（Design for Manufacturing）工程师生成专属视图文档 `docs/fa-view.md`，聚焦可制造性设计、测试点设计和工艺要求。

**Execution Steps (for the AI assistant)**
1. 在目标项目根目录工作，与用户确认当前特性的 `FEATURE_DIR = specs/00X-shortname/`，并在其中定位：
   - `FEATURE_TASKS  = FEATURE_DIR/tasks.md`；
   - `FEATURE_DOCS   = FEATURE_DIR/docs/`（如不存在，则创建）。

2. 从 `tasks.md` 中提取 `[VIEW:FA]` 标记的任务：
   - 扫描 `tasks.md` 中所有任务描述；
   - 筛选包含 `[VIEW:FA]` 标记的任务；
   - 这些任务通常涉及DFM评估、测试点设计、工艺可行性分析等。

3. 提取DFM评估结果：
   - 对于已完成的 `[VIEW:FA]` DFM评估任务，从任务描述或关联文档中提取：
     - **器件布局检查**：元器件间距、方向一致性、禁布区；
     - **焊盘设计检查**：焊盘尺寸、间距是否符合IPC标准；
     - **PCB工艺检查**：最小线宽/线距、最小钻孔、阻焊开窗；
     - **热设计检查**：散热器布局、热焊盘处理、热过孔；
     - **可维修性检查**：关键器件可拆卸性、返修空间。
   - 对于未完成的任务，标记为"待评估"。

4. 提取测试点设计要求：
   - 识别需要测试点的关键信号（如母线电压、输出电压、控制信号）；
   - 列出测试点位号、信号名称、测试目的（如"TP1: VBUS, 用于母线电压测量"）；
   - 检查测试点布局是否满足探针接触要求（间距、直径、可访问性）；
   - 标识缺失的测试点或测试点位置不合理的情况。

5. 生成 `FEATURE_DIR/docs/fa-view.md`：
   - **DFM评估清单**：列出DFM检查项及其评估结果（通过/不通过/待评估）；
   - **测试点清单**：列出所有测试点及其用途；
   - **工艺要求**：PCB层叠结构、铜厚、表面处理、阻焊颜色等；
   - **装配注意事项**：特殊器件装配要求（如变压器方向、极性电容方向）；
   - **待改进项**：列出DFM评估中发现的问题和改进建议。

6. 向用户总结：
   - 本次生成的 `fa-view.md` 包含了哪些DFM检查项和测试点；
   - DFM评估发现的问题和建议改进的地方；
   - 提醒关注的工艺风险；
   - 建议下一步操作（如"调整PCB布局以满足DFM要求"、"补充测试点"）。

**Notes**
- `/elecspeckit.doc-fa` 专注于FA和DFM工程师视角，不涉及功能设计或测试执行；
- DFM评估结果应基于实际PCB设计文件，如设计尚未完成应明确标注"待评估"；
- `[VIEW:FA]` 标记用于在 `tasks.md` 中标识FA/DFM相关任务，确保任务拆分时正确标记；
- 测试点设计应在PCB布局阶段完成，确保后续测试和调试的可行性。

**Example: FA视图文档结构**

```markdown
# FA/DFM视图: 60W PD充电头

## DFM评估清单

### 器件布局检查

- [x] 元器件间距符合IPC-A-610标准 (≥0.5mm)
- [x] 极性器件方向一致（电解电容正极朝上）
- [ ] 高压区域禁布检查（初级-次级爬电距离 ≥6.4mm）**待确认PCB布局**
- [x] 关键器件（MOSFET、变压器）散热空间充足

### 焊盘设计检查

- [x] SMD焊盘尺寸符合IPC-7351标准
- [x] THT焊盘直径 ≥ 引脚直径 + 0.3mm
- [x] BGA焊盘间距 ≥ 0.25mm (本设计无BGA)
- [ ] 测试点焊盘直径 ≥ 1.0mm **部分测试点需调整**

### PCB工艺检查

- [x] 最小线宽/线距: 6mil/6mil（符合工厂能力）
- [x] 最小钻孔: 0.3mm（符合工厂能力）
- [x] 阻焊开窗: SMD焊盘外扩0.1mm
- [ ] 热焊盘设计: 变压器热焊盘需补充热过孔 **待补充**
- [x] 铜厚: 1oz（内层）/ 2oz（外层，电源走线）

### 热设计检查

- [x] MOSFET散热器布局合理，与变压器间距 >5mm
- [ ] 温升仿真: 待补充热仿真数据 **待执行**
- [x] 热过孔: 功率器件热焊盘下补充热过孔（≥4个，直径0.3mm）

### 可维修性检查

- [x] 关键器件（MOSFET、IC）可拆卸，周围预留返修空间
- [x] 变压器、电感使用THT封装，便于更换
- [ ] 测试点可访问性: 部分测试点被散热器遮挡 **需调整位置**

## 测试点清单

| 测试点 | 信号名称 | 测试目的 | 位置 | 状态 |
|--------|---------|---------|------|------|
| TP1 | VBUS | 母线电压测量 (380-400VDC) | PCB顶层，PFC输出 | ✓ 已设计 |
| TP2 | VOUT | 输出电压测量 (5-20V) | PCB顶层，输出端 | ✓ 已设计 |
| TP3 | CS_PFC | PFC电流采样 | PCB底层，PFC控制器附近 | ✓ 已设计 |
| TP4 | CS_LLC | LLC电流采样 | PCB底层，LLC控制器附近 | ✓ 已设计 |
| TP5 | FB | 反馈信号测量 | PCB顶层，隔离反馈 | △ 位置被散热器遮挡，需调整 |
| TP6 | GND | 接地参考点 | PCB四角各一个 | ✓ 已设计 |

## 工艺要求

### PCB规格

- **层数**: 4层 (Top Signal / GND / Power / Bottom Signal)
- **板厚**: 1.6mm
- **铜厚**: 内层1oz / 外层2oz（电源走线区域）
- **表面处理**: 沉金（ENIG），厚度3-5μm
- **阻焊**: 绿色，哑光
- **字符**: 白色，丝印

### PCB工艺能力要求

- **最小线宽/线距**: 6mil/6mil
- **最小钻孔**: 0.3mm
- **最小环宽**: 0.15mm
- **最小阻焊桥**: 0.1mm
- **阻焊开窗**: SMD焊盘外扩0.1mm

### 特殊工艺

- **隔离槽**: 初级-次级之间铣槽，宽度≥2mm，深度至GND层
- **热过孔**: 功率器件热焊盘下补充热过孔（直径0.3mm，间距1mm）
- **高压区域**: 加强绝缘区域禁止布线

## 装配注意事项

1. **变压器T1**: 安装时注意初级/次级引脚对应，不可装反。变压器上有标识点表示Pin 1。
2. **极性电容**: 电解电容C5、C8的正极朝向PCB上标注方向（正极标记为"+"）。
3. **MOSFET散热器**: Q1的散热器与PCB垂直安装，使用绝缘片隔离，螺丝拧紧力矩2-3N·m。
4. **测试点**: TP1（高压）测试时注意安全，使用绝缘探针。
5. **隔离槽**: 装配前检查隔离槽无毛刺、无残留铜箔。

## 待改进项

1. **测试点TP5位置调整**: 当前位置被散热器遮挡，建议移至散热器外侧，便于探针接触。
2. **变压器热焊盘补充热过孔**: 当前仅有2个热过孔，建议增加到4个，改善散热。
3. **高压区域爬电距离确认**: 待PCB布局完成后，使用DRC检查初级-次级爬电距离是否满足≥6.4mm要求。
4. **温升仿真**: 补充热仿真分析，确认满载时关键器件温升符合降额要求（器件表面温度<器件额定温度-20°C）。

## 下一步建议

1. 调整TP5测试点位置，确保散热器不遮挡
2. 补充变压器热焊盘的热过孔（增加到4个）
3. 完成PCB布局后，执行DRC检查（爬电距离、线宽线距、钻孔）
4. 执行热仿真，验证散热设计充分性
5. 提交PCB文件给工厂，确认工艺可行性
```
"""
