description = "为BOM工程师生成物料清单视图文档"

prompt = """---
description: 为BOM工程师生成物料清单视图文档
handoffs: []
---

## Command: `/elecspeckit.doc-bom`

**Goal**
基于当前硬件特性的 `tasks.md`，为BOM工程师生成专属的物料清单视图文档 `docs/bom-view.md`，聚焦器件选型、供应商信息、成本分析和交期管理。

**Execution Steps (for the AI assistant)**
1. 在目标项目根目录工作，与用户确认当前特性的 `FEATURE_DIR = specs/00X-shortname/`，并在其中定位：
   - `FEATURE_TASKS  = FEATURE_DIR/tasks.md`；
   - `FEATURE_DOCS   = FEATURE_DIR/docs/`（如不存在，则创建）。

2. 从 `tasks.md` 中提取 `[VIEW:BOM]` 标记的任务：
   - 扫描 `tasks.md` 中所有任务描述；
   - 筛选包含 `[VIEW:BOM]` 标记的任务；
   - 这些任务通常涉及器件选型、BOM清单生成、供应商询价、成本核算等。

3. 提取已完成的器件选型信息：
   - 对于已完成的 `[VIEW:BOM]` 任务，从任务描述或关联文档中提取：
     - **器件规格**：型号、封装、关键参数（如电压、电流、容值、阻值等）；
     - **供应商信息**：推荐供应商、备选供应商、供应商料号；
     - **单价**：单片价格（按采购量区间）；
     - **交期**：标准交期、库存状态。
   - 对于未完成的任务，标记为"待选型"或"待询价"。

4. 生成BOM清单汇总：
   - 按功能模块分组（如 AC Input Filter, PFC Module, DC-DC Module）；
   - 列出每个模块的器件清单：位号、型号、封装、数量、单价、总价；
   - 计算每个模块的物料成本小计；
   - 计算整体BOM成本（不含PCB、壳体、包装等）。

5. 生成成本分析：
   - **成本构成**：列出各功能模块的成本占比（如 PFC 模块占30%，DC-DC模块占40%）；
   - **降本机会**：基于已完成的器件选型，识别高成本器件，提出降本建议（如替换为性价比更高的型号）；
   - **风险提示**：标识供应链风险（如单一供应商、长交期、停产风险）。

6. 生成 `FEATURE_DIR/docs/bom-view.md`：
   - **BOM清单**：按模块分组的器件列表；
   - **供应商信息**：推荐供应商、备选供应商、联系方式；
   - **成本分析**：总成本、成本构成、降本建议；
   - **交期管理**：关键器件交期、库存状态、采购优先级；
   - **待选型任务**：列出尚未完成的器件选型任务，提醒BOM工程师跟进。

7. 向用户总结：
   - 本次生成的 `bom-view.md` 包含了哪些模块的BOM清单；
   - 当前BOM成本估算；
   - 提醒关注的供应链风险和降本机会；
   - 建议下一步操作（如"完成待选型任务"、"执行供应商询价"）。

**Notes**
- `/elecspeckit.doc-bom` 专注于BOM工程师视角，不涉及硬件设计或测试任务；
- BOM清单应与 `plan.md` 中的架构模块定义保持一致，确保模块划分统一；
- `[VIEW:BOM]` 标记用于在 `tasks.md` 中标识BOM相关任务，确保任务拆分时正确标记；
- 成本分析基于已完成的器件选型信息，如信息不完整应明确标注"待询价"或"待确认"。

**Example: BOM视图文档结构**

```markdown
# BOM清单视图: 60W PD充电头

## BOM清单

### AC Input Filter Module

| 位号 | 器件型号 | 封装 | 规格参数 | 数量 | 单价(¥) | 总价(¥) | 供应商 |
|------|---------|------|---------|------|---------|---------|--------|
| L1   | WE-CMB 7447779110 | THT | 10mH, 1.5A | 1 | 3.50 | 3.50 | Würth Elektronik |
| C1,C2 | KEMET X2 C4AQFBW5470ZDJK | 16mm | 0.47µF, 310VAC | 2 | 1.20 | 2.40 | KEMET |
| MOV1 | Littelfuse V14E275P | 14mm | 275VAC | 1 | 0.80 | 0.80 | Littelfuse |

**模块小计**: ¥6.70

### PFC Module

| 位号 | 器件型号 | 封装 | 规格参数 | 数量 | 单价(¥) | 总价(¥) | 供应商 |
|------|---------|------|---------|------|---------|---------|--------|
| U1   | TI UCC28070 | SOIC-20 | PFC控制器 | 1 | 8.50 | 8.50 | TI |
| Q1   | Infineon IPW60R045CP | TO-247 | 600V/45mΩ MOSFET | 1 | 12.00 | 12.00 | Infineon |
| D1   | Vishay VS-10ETS12-M3 | TO-220AC | 1200V/10A 二极管 | 1 | 4.50 | 4.50 | Vishay |

**模块小计**: ¥25.00

### DC-DC Module (LLC)

| 位号 | 器件型号 | 封装 | 规格参数 | 数量 | 单价(¥) | 总价(¥) | 供应商 |
|------|---------|------|---------|------|---------|---------|--------|
| U2   | ON Semi NCP13992 | SOIC-14 | LLC控制器 | 1 | 6.50 | 6.50 | ON Semiconductor |
| T1   | Custom LLC Transformer | EE42 | 待定制 | 1 | 待询价 | - | 待确定 |

**模块小计**: ¥6.50 (变压器待询价)

## BOM成本汇总

| 功能模块 | 成本(¥) | 占比 |
|---------|---------|------|
| AC Input Filter | 6.70 | 11% |
| PFC Module | 25.00 | 41% |
| DC-DC Module | 6.50+ | 11%+ |
| PD Protocol | 待选型 | - |
| **总计** | **38.20+** | **63%+** |

**说明**: 成本估算基于已完成的器件选型，部分器件（变压器、PD协议芯片）待询价。

## 成本分析

### 高成本器件

1. **Q1 (Infineon IPW60R045CP)**: ¥12.00
   - 降本建议: 考虑国产替代方案（如乐山无线电 NCE60R048P），预计降本30%
   - 风险: 需验证国产器件的可靠性

2. **U1 (TI UCC28070)**: ¥8.50
   - 降本建议: 评估 NXP TEA1733 (¥7.00)，功能相近
   - 风险: 需调整外围电路

### 供应链风险

- **变压器定制**: 需与变压器厂商确认交期（通常4-6周），建议提前下单
- **IPW60R045CP**: Infineon 单一供应商，库存紧张，建议备选方案

## 供应商信息

| 供应商 | 联系方式 | 主要供货器件 | 备注 |
|--------|---------|-------------|------|
| Würth Elektronik | sales@we-online.com | 电感、变压器 | 支持小批量采购 |
| KEMET | kemet@kemet.com | 电容 | 交期稳定 |
| TI | ti-support@ti.com | IC | 需通过代理商 |
| Infineon | infineon@infineon.com | MOSFET | 长交期（8-12周）|

## 待选型任务

- [ ] T030 [VIEW:BOM] 选型USB PD协议芯片（支持PD 3.0, 5V-20V）
- [ ] T035 [VIEW:BOM] 询价LLC变压器（EE42, 匝比待确认）
- [ ] T042 [VIEW:BOM] 选型同步整流MOSFET（30V, RDS(on) <5mΩ）

## 下一步建议

1. 完成待选型任务（T030, T035, T042）
2. 执行供应商询价，更新成本估算
3. 评估降本方案可行性
4. 确认关键器件交期，制定采购计划
```
"""
